<!DOCTYPE html>

<html>
<head>
  <title>DataFrame.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
  
</head>
<head>
</head>
<body>
  <div id="container">
    
      <div id="background"></div>
    
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="DataFrame.html">
                  DataFrame.js
                </a>
              
                
                <a class="source" href="ViewTheme.html">
                  ViewTheme.js
                </a>
              
                
                <a class="source" href="WdfView.html">
                  WdfView.js
                </a>
              
                
                <a class="source" href="WebPath.html">
                  WebPath.js
                </a>
              
                
                <a class="source" href="cacheit.html">
                  cacheit.js
                </a>
              
                
                <a class="source" href="index.html">
                  index.md
                </a>
              
                
                <a class="source" href="test.html">
                  test.md
                </a>
              
                
                <a class="source" href="index.html">
                  index.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
                
                <a class="source" href="webpack.config.html">
                  webpack.config.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>DataFrame.js</h1>
              </div>
          </li>
        
        
        <li id="section-1">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="private-stuff">Private stuff</h2>
<p>methods and classes that not supposed to be used directly</p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">  "use strict"</span>;

  <span class="hljs-keyword">var</span> u$ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./utils"</span>);
  <span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"lodash"</span>);</pre></div></div>
            
        </li>
        
              <a name="Column" />
        
        <li id="section-2">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p><code>Column</code> has <code>name</code>. Also <code>data</code> array is there to store all columnâ€™s value.
Optionally if <code>type</code> defined when all <code>data</code> assumed to be casted to that type (
See <a href="types.html">type</a> ). Also <code>col_idx</code> point on this column in column set.</p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">var</span> Column = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, len, type</span>) </span>{
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">this</span>.data = [];
    <span class="hljs-keyword">if</span> (len) {
      <span class="hljs-keyword">this</span>.data.length = len;
    }
    <span class="hljs-keyword">this</span>.setType(type,<span class="hljs-literal">false</span>);
  };

  Column.prototype.coerceData = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">from_type</span>)</span>{
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> row = <span class="hljs-number">0</span> ; row &lt; <span class="hljs-keyword">this</span>.data.length ; row++ ){
      <span class="hljs-keyword">this</span>.data[row] = <span class="hljs-keyword">this</span>.type.coerce(<span class="hljs-keyword">this</span>.data[row],from_type);
    }
  };

  Column.prototype.detectData = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span>( u$.isNullish(<span class="hljs-keyword">this</span>.type) || <span class="hljs-keyword">this</span>.type.name === <span class="hljs-string">"string"</span> ){
      <span class="hljs-keyword">var</span> options = u$.detect_possible_array_types(<span class="hljs-keyword">this</span>.data);
      <span class="hljs-keyword">var</span> option = u$.choose_column_type(options);
      <span class="hljs-keyword">if</span>(option.type !== <span class="hljs-keyword">this</span>.type){
        <span class="hljs-keyword">this</span>.setType(option.type,<span class="hljs-literal">false</span>);
        <span class="hljs-keyword">this</span>.data = option.array;
      }
    }
  };

  Column.prototype.setType = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">type,if_coerce</span>)</span>{
    <span class="hljs-keyword">var</span> coerce_from = <span class="hljs-keyword">this</span>.type;
    <span class="hljs-keyword">this</span>.type = u$.ensureType(type);
    <span class="hljs-keyword">this</span>.get = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">row</span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.data[row];
    };
    <span class="hljs-keyword">var</span> to_string = u$.get_to_string(<span class="hljs-keyword">this</span>.type);
    <span class="hljs-keyword">this</span>.to_string = to_string ;
    <span class="hljs-keyword">this</span>.as_string = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>) </span>{
      <span class="hljs-keyword">return</span> to_string(<span class="hljs-keyword">this</span>.data[row]);
    };
    <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.type ){
      <span class="hljs-keyword">this</span>.as_json = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.type.to_json(<span class="hljs-keyword">this</span>.data[row]);
      };
      <span class="hljs-keyword">this</span>.set = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row,v</span>)</span>{
        <span class="hljs-keyword">this</span>.data[row] = <span class="hljs-keyword">this</span>.type.coerce(v);
      };
      <span class="hljs-keyword">if</span>(if_coerce &amp;&amp; !u$.isNullish(coerce_from) ){
        <span class="hljs-keyword">this</span>.coerceData(coerce_from);
      }
    }<span class="hljs-keyword">else</span>{
      <span class="hljs-keyword">this</span>.as_json = <span class="hljs-keyword">this</span>.get ;
      <span class="hljs-keyword">this</span>.set = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row,v</span>)</span>{
        <span class="hljs-keyword">this</span>.data[row] = v;
      };
    }
  };</pre></div></div>
            
        </li>
        
              <a name="ColumnSet" />
        
        <li id="section-3">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>ColumnSet - store all columns <code>byIndex</code> in array and  <code>byName</code> in hashtable.</p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ColumnSet = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.byIndex = [];
    <span class="hljs-keyword">this</span>.byName = {};
  };</pre></div></div>
            
        </li>
        
              <a name="ColumnSet.prototype.getColumn" />
        
        <li id="section-4">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>get column either by name or by index</p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>  ColumnSet.prototype.getColumn = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name_or_idx</span>) </span>{
    <span class="hljs-keyword">return</span> (_.isNumber(name_or_idx) ? <span class="hljs-keyword">this</span>.byIndex : <span class="hljs-keyword">this</span>.byName )[name_or_idx];
  };</pre></div></div>
            
        </li>
        
              <a name="ColumnSet.prototype.enforceColumn" />
        
        <li id="section-5">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>enforce column by name</p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>  ColumnSet.prototype.enforceColumn = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, n_rows, type</span>) </span>{
    <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">this</span>.byName[name];
    <span class="hljs-keyword">if</span> (u$.isNullish(c)) {
      c = <span class="hljs-keyword">new</span> Column(name, n_rows, type);
      c.col_idx = <span class="hljs-keyword">this</span>.byIndex.length;
      <span class="hljs-keyword">this</span>.byIndex.push(c);
      <span class="hljs-keyword">this</span>.byName[name] = c;
    }
    <span class="hljs-keyword">return</span> c;
  };</pre></div></div>
            
        </li>
        
              <a name="ColumnSet.prototype.enforceColumnAt" />
        
        <li id="section-6">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>enforce column by <code>col_idx</code>, <code>name</code> will be set to <code>&#39;c&#39;+col_idx</code></p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>  ColumnSet.prototype.enforceColumnAt = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">col_idx, n_rows, type</span>) </span>{
    <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">this</span>.byIndex[col_idx];
    <span class="hljs-keyword">if</span> (u$.isNullish(c)) {
      <span class="hljs-keyword">var</span> name = <span class="hljs-string">"c"</span> + col_idx;
      c = <span class="hljs-keyword">new</span> Column(name, n_rows, type);
      c.col_idx = col_idx;
      <span class="hljs-keyword">this</span>.byIndex[col_idx] = c;
      <span class="hljs-keyword">this</span>.byName[name] = c;
    }
    <span class="hljs-keyword">return</span> c;
  };</pre></div></div>
            
        </li>
        
              <a name="ColumnSet.prototype.addColumns" />
        
        <li id="section-7">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>add bunch of columns, preallocate array for <code>n_rows</code></p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>  ColumnSet.prototype.addColumns = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cols, n_rows</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; cols.length; i++) {
      <span class="hljs-keyword">var</span> name = cols[i], type;
      <span class="hljs-keyword">if</span> (_.isPlainObject(cols[i])) {
        name = cols[i].name;
        type = u$.ensureType(cols[i].type);
      }
      <span class="hljs-keyword">this</span>.enforceColumn(name, n_rows, type);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  };

  ColumnSet.prototype.getFormats=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>)</span>{
    config = config || {};
    <span class="hljs-keyword">if</span>(!config.fn){
      <span class="hljs-keyword">if</span>(config.by_names || config.by_types){
        <span class="hljs-keyword">if</span>( !config.by_names ) {
          config.format_fn = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_,type_name</span>)</span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.by_types[type_name]; };
        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( !config.by_types ) {
          config.format_fn = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">col_name,_</span>)</span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.by_names[col_name]; } ;
        }<span class="hljs-keyword">else</span>{
          config.format_fn = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">col_name,type_name</span>)</span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.by_names[col_name] || <span class="hljs-keyword">this</span>.by_types[type_name]; };
        }
      }
    }
    <span class="hljs-keyword">var</span> formats = [] ;
    <span class="hljs-keyword">var</span> col_names = config.columns || <span class="hljs-built_in">Object</span>.keys(<span class="hljs-keyword">this</span>.byName);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span> ; i &lt; col_names.length ; i++){
      <span class="hljs-keyword">var</span> col_name = col_names[i];
      <span class="hljs-keyword">var</span> col = <span class="hljs-keyword">this</span>.byName[col_name];
      <span class="hljs-keyword">var</span> type_name = col.type &amp;&amp; col.type.name;
      formats[i] = {
          name: col_name,
          index: col.col_idx,
          title: (config.title_fn &amp;&amp; config.title_fn(col_name,type_name,col)) || col_name,
          type: type_name,
          format: (config.format_fn &amp;&amp; config.format_fn(col_name,type_name,col)) || col.to_string
      };
    }
    <span class="hljs-keyword">return</span> formats;
  };

  ColumnSet.prototype.getStorageSize=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">max_data_length</span>(<span class="hljs-params">prev, col</span>) </span>{
      <span class="hljs-keyword">return</span> prev &gt; col.data.length ? prev : col.data.length;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.byIndex.reduce(max_data_length, <span class="hljs-number">0</span>);
  };

  ColumnSet.prototype.setStorageSize=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">size</span>)</span>{
    <span class="hljs-keyword">var</span> storageSize = <span class="hljs-keyword">this</span>.getStorageSize();
    <span class="hljs-keyword">if</span>( size &lt; storageSize ){
      <span class="hljs-keyword">throw</span> u$.error({ msg:<span class="hljs-string">'cannot reduce column storage size'</span>,
        current: storageSize, requested: size} );
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.byIndex.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">col</span>)</span>{col.data.length = size;});
  };</pre></div></div>
            
        </li>
        
              <a name="DataFrame" />
        
        <li id="section-8">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2 id="-section-id-dataframe-dataframe-section-"><section id='DataFrame'>Dataframe</section></h2>
<p><strong>new Dataframe(rows,columns)</strong>:</p>
<ul>
<li><code>rows</code> - array of rows. row could be array or object.</li>
<li><code>config</code> :<ul>
<li><code>columns</code> - array that contains column names or objects with
<code>{name: &quot;colname&quot;,type: &quot;number&quot;}</code>.</li>
</ul>
</li>
</ul>

            </div>
            
                 <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">var</span> DataFrame = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rows, config</span>) </span>{
    <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">if</span> (_.isUndefined(obj) || obj.constructor !== DataFrame) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DataFrame(rows, config);
    }
    config = config || {};
    rows = rows || [];
    <span class="hljs-keyword">this</span>.columnSet = <span class="hljs-keyword">new</span> ColumnSet().addColumns(config.columns || [], rows.length);
    <span class="hljs-keyword">this</span>.index = _.range(rows.length);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> row = <span class="hljs-number">0</span>; row &lt; rows.length; row++) {
      <span class="hljs-keyword">var</span> row_data = rows[row];
      <span class="hljs-keyword">if</span> (_.isPlainObject(row_data)) {
        <span class="hljs-keyword">var</span> keys = <span class="hljs-built_in">Object</span>.keys(row_data);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; keys.length; k++) {
          <span class="hljs-keyword">this</span>.columnSet.enforceColumn(keys[k]).set(row, row_data[keys[k]]);
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isArray(row_data)) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> col_idx = <span class="hljs-number">0</span>; col_idx &lt; row_data.length; col_idx++) {
          <span class="hljs-keyword">this</span>.columnSet.enforceColumnAt(col_idx).set(row, row_data[col_idx]);
        }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> u$.error(<span class="hljs-string">"row should be object or array and not:"</span> + row_data);
      }
    }
    <span class="hljs-keyword">return</span> obj;
  };

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">make_df_from_</span>(<span class="hljs-params">array_of_rows, config</span>) </span>{
    config = config || {columns: array_of_rows.shift()};
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DataFrame(array_of_rows, config);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse_csv_to_array_of_rows</span>(<span class="hljs-params">str,offset</span>) </span>{
    <span class="hljs-keyword">var</span> arr = [];
    <span class="hljs-keyword">var</span> quote = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// true means we're inside a quoted field</span>

    <span class="hljs-keyword">var</span> row, col, c;
    <span class="hljs-keyword">for</span> (row = col = <span class="hljs-number">0</span> , c = offset; c &lt; str.length; c++) {
      <span class="hljs-keyword">var</span> cc = str[c], nc = str[c + <span class="hljs-number">1</span>];        <span class="hljs-comment">// current character, next character</span>
      arr[row] = arr[row] || [];             <span class="hljs-comment">// create a new row if necessary</span>
      arr[row][col] = arr[row][col] || <span class="hljs-string">''</span>;   <span class="hljs-comment">// create a new column (start with empty string) if necessary</span>
      <span class="hljs-keyword">if</span> (cc === <span class="hljs-string">'"'</span> &amp;&amp; quote &amp;&amp; nc === <span class="hljs-string">'"'</span>) { <span class="hljs-comment">// if two quotes inside quoted field</span>
        arr[row][col] += cc;
        ++c;
        <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// add quote and skip next char</span>
      }
      <span class="hljs-keyword">if</span> (cc === <span class="hljs-string">'"'</span>) { <span class="hljs-comment">// if lone quote</span>
        quote = !quote;
        <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// toggle quoted field</span>
      }
      <span class="hljs-keyword">if</span> (cc === <span class="hljs-string">','</span> &amp;&amp; !quote) { <span class="hljs-comment">// if comma in the wild</span>
        ++col;
        <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// start next cell</span>
      }
      <span class="hljs-keyword">if</span> (cc === <span class="hljs-string">'\n'</span> &amp;&amp; !quote) { <span class="hljs-comment">// if new line in the wild</span>
        ++row;
        col = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">continue</span>;  <span class="hljs-comment">// move to next row</span>
      }
      arr[row][col] += cc; <span class="hljs-comment">// or add char to current cell</span>
    }
    <span class="hljs-keyword">return</span> arr;
  }

  DataFrame.prototype.to_csv = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> s = <span class="hljs-string">''</span> , col,row, v, cc;
    <span class="hljs-keyword">for</span> (col = <span class="hljs-number">0</span>; col &lt; <span class="hljs-keyword">this</span>.columnSet.byIndex.length; col++) {
      <span class="hljs-keyword">if</span> (col &gt; <span class="hljs-number">0</span> ) {
        s+= <span class="hljs-string">','</span> ;
      }
      s+= <span class="hljs-keyword">this</span>.columnSet.byIndex[col].name;
    }
    s+= <span class="hljs-string">'\n'</span>;
    <span class="hljs-keyword">for</span> (row = <span class="hljs-number">0</span>; row &lt; <span class="hljs-keyword">this</span>.getRowCount(); row++) {
      <span class="hljs-keyword">for</span> (col = <span class="hljs-number">0</span>; col &lt; <span class="hljs-keyword">this</span>.columnSet.byIndex.length; col++) {
        <span class="hljs-keyword">if</span> (col &gt; <span class="hljs-number">0</span> ) {
          s+= <span class="hljs-string">','</span> ;
        }
        v = <span class="hljs-keyword">this</span>.get(row,col,<span class="hljs-string">'as_string'</span>);
        <span class="hljs-keyword">if</span>( v.indexOf(<span class="hljs-string">'"'</span>) &gt;= <span class="hljs-number">0</span> ||
            v.indexOf(<span class="hljs-string">','</span>) &gt;= <span class="hljs-number">0</span> ||
            v.indexOf(<span class="hljs-string">'\n'</span>) &gt;= <span class="hljs-number">0</span> ){
          s+=<span class="hljs-string">'"'</span>;
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; v.length; i++) {
            cc = v[i];
            <span class="hljs-keyword">if</span>(cc===<span class="hljs-string">'"'</span>) {
              s += cc;
            }
            s+= cc;
          }
          s+=<span class="hljs-string">'"'</span>;
        }<span class="hljs-keyword">else</span>{
          s+= v;
        }
      }
      s+= <span class="hljs-string">'\n'</span>;
    }
    <span class="hljs-keyword">return</span> s;
  };</pre></div></div>
            
        </li>
        
              <a name="DataFrame.parse_csv" />
        
        <li id="section-9">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>parse_csv(str,header)</strong></p>
<p>parse comma separated values (CSV) format  provided in string <code>str</code>.
<code>header</code> is array with column names, if omitted first line of  CSV  in <code>str</code> considered header .</p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>
  DataFrame.parse_csv = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">str, config</span>) </span>{
    <span class="hljs-keyword">return</span> make_df_from_(parse_csv_to_array_of_rows(str,<span class="hljs-number">0</span>), config);
  };

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse_lf_separated</span>(<span class="hljs-params">str,offset</span>)</span>{
    <span class="hljs-keyword">var</span> arr = [], row = <span class="hljs-string">''</span>, c;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append_row</span>(<span class="hljs-params"></span>)</span>{
        arr.push([row]);
    }
    <span class="hljs-keyword">for</span> (c = offset; c &lt; str.length; c++) {
      <span class="hljs-keyword">var</span> cc = str[c];
      <span class="hljs-keyword">if</span> (cc === <span class="hljs-string">'\n'</span>) {
        append_row();
        row = <span class="hljs-string">''</span>;
      } <span class="hljs-keyword">else</span> {
        row += cc;
      }
    }
    append_row();
    <span class="hljs-keyword">return</span> arr;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse_lf_separated_json</span>(<span class="hljs-params">str,offset</span>)</span>{
    <span class="hljs-keyword">var</span> arr = [], row = <span class="hljs-string">''</span>, c;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append_row</span>(<span class="hljs-params"></span>)</span>{
      <span class="hljs-keyword">if</span>(row.length &gt; <span class="hljs-number">0</span>){
        arr.push(<span class="hljs-built_in">JSON</span>.parse(row));
      }
    }
    <span class="hljs-keyword">for</span> (c = offset; c &lt; str.length; c++) {
      <span class="hljs-keyword">var</span> cc = str[c];
      <span class="hljs-keyword">if</span> (cc === <span class="hljs-string">'\n'</span>) {
        append_row();
        row = <span class="hljs-string">''</span>;
      } <span class="hljs-keyword">else</span> {
        row += cc;
      }
    }
    append_row();
    <span class="hljs-keyword">return</span> arr;
  }
  DataFrame.parse_wdf=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>{
    <span class="hljs-keyword">var</span> rows = parse_lf_separated_json(str,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">var</span> config = rows.shift();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DataFrame(rows,config);
  };

  DataFrame.parse_json=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">json</span>) </span>{
    json = u$.ensurePlainObject(json);
    <span class="hljs-keyword">if</span>( u$.isNullish(json) || json <span class="hljs-keyword">instanceof</span> DataFrame){
      <span class="hljs-keyword">return</span> json;
    }
    <span class="hljs-keyword">if</span>(json.type===<span class="hljs-string">'DataFrame'</span>){
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DataFrame(json.rows,json.config);
    }
    <span class="hljs-keyword">throw</span> u$.error({
      msg: <span class="hljs-string">'not valid DataFrame json'</span>,
      json: json
    });
  };

  DataFrame.prototype.to_wdf=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> s = <span class="hljs-string">''</span>;
    s+=<span class="hljs-built_in">JSON</span>.stringify(<span class="hljs-keyword">this</span>.getConfig());
    s+=<span class="hljs-string">'\n'</span>;
    <span class="hljs-keyword">this</span>.apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>)</span>{
      s+=<span class="hljs-built_in">JSON</span>.stringify(<span class="hljs-keyword">this</span>.getJsonRow(row));
      s+=<span class="hljs-string">'\n'</span>;
    });
    <span class="hljs-keyword">return</span> s;
  };
  DataFrame.prototype.to_json = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> {
      type: <span class="hljs-string">'DataFrame'</span>,
      config: <span class="hljs-keyword">this</span>.getConfig(),
      rows: <span class="hljs-keyword">this</span>.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getJsonRow(row);
      })
    };
  };

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse_dom_table_to_array_of_rows</span>(<span class="hljs-params">dom_table</span>) </span>{
    <span class="hljs-keyword">return</span> [].map.call(dom_table.rows, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dom_row</span>) </span>{
      <span class="hljs-keyword">return</span> [].map.call(dom_row.cells, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">c</span>) </span>{
        <span class="hljs-keyword">return</span> c.textContent;
      });
    });
  }

  DataFrame.prototype.detectColumnTypes=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">list_of_columns</span>)</span>{
    list_of_columns = list_of_columns || <span class="hljs-keyword">this</span>.getColumnNames();
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span> ; i &lt; list_of_columns.length ; i++){
      <span class="hljs-keyword">var</span> col = <span class="hljs-keyword">this</span>.columnSet.byName[list_of_columns[i]];
      col.detectData();
    }
  };</pre></div></div>
            
        </li>
        
              <a name="DataFrame.parse_dom_table" />
        
        <li id="section-10">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><strong>parse_dom_table(dom_table, header)</strong></p>
<p>parse comma separated values (CSV) format  provided in string <code>dom_table</code>.
<code>header</code> is array with column names, if omitted first row in  table
considered header .</p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>
  DataFrame.parse_dom_table = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dom_table, config</span>) </span>{
    <span class="hljs-keyword">return</span> make_df_from_(parse_dom_table_to_array_of_rows(dom_table), config);
  };

  DataFrame.prototype.getColumnNames=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.keys(<span class="hljs-keyword">this</span>.columnSet.byName);
  };

  DataFrame.prototype.getColumnCount=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.columnSet.byIndex.length;
  };</pre></div></div>
            
        </li>
        
              <a name="DataFrame.prototype.getObjectRow" />
        
        <li id="section-11">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><strong>getObjectRow(row_num,result)</strong></p>
<p>get row out of DataFrame as plain object.</p>
<ul>
<li><code>row_num</code> - row number</li>
</ul>

            </div>
            
                 <div class="content"><div class='highlight'><pre>
  DataFrame.prototype.getObjectRow = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">row_num</span>) </span>{
    <span class="hljs-keyword">var</span> ph_row = <span class="hljs-keyword">this</span>.index[row_num];
    <span class="hljs-keyword">var</span> result =  {};
    <span class="hljs-keyword">this</span>.columnSet.byIndex.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">c</span>) </span>{
          result[c.name] = c.get(ph_row);
        });
    <span class="hljs-keyword">return</span> result;
  };</pre></div></div>
            
        </li>
        
              <a name="DataFrame.prototype.getArrayRow" />
        
        <li id="section-12">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>getObjectRow(row_num,result)</strong></p>
<p>get row out of DataFrame as array (no type conversion).</p>
<ul>
<li><code>row_num</code> - row number</li>
<li><code>fn</code> - how to extract value: <code>get()</code> or <code>as_json()</code></li>
</ul>

            </div>
            
                 <div class="content"><div class='highlight'><pre>  DataFrame.prototype.getArrayRow = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">row_num,fn</span>) </span>{
    fn = fn || <span class="hljs-string">'get'</span>;
    <span class="hljs-keyword">var</span> ph_row = <span class="hljs-keyword">this</span>.index[row_num];
    <span class="hljs-keyword">var</span> result = [];
    result.length = <span class="hljs-keyword">this</span>.columnSet.byIndex.length ;
    <span class="hljs-keyword">this</span>.columnSet.byIndex.forEach( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">c, col_idx</span>) </span>{
          result[col_idx] = c[fn](ph_row);
        });
    <span class="hljs-keyword">return</span> result;
  };</pre></div></div>
            
        </li>
        
              <a name="DataFrame.prototype.getJsonRow" />
        
        <li id="section-13">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>getJsonRow(row_num)</strong></p>
<p>get data row as array with dates converted to string
for json</p>
<ul>
<li><code>row_num</code> - row number</li>
</ul>

            </div>
            
                 <div class="content"><div class='highlight'><pre>
  DataFrame.prototype.getJsonRow = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">row_num</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getArrayRow(row_num,<span class="hljs-string">'as_json'</span>);
  };</pre></div></div>
            
        </li>
        
              <a name="DataFrame.prototype.get" />
        
        <li id="section-14">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><strong>get(row,col)</strong></p>
<p>get one value out of DataFrame</p>
<ul>
<li><code>row_num</code> - row number</li>
<li><code>col</code> - column index or column name</li>
<li><code>fn</code> -</li>
</ul>

            </div>
            
                 <div class="content"><div class='highlight'><pre>  DataFrame.prototype.get = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">row_num, col,fn</span>) </span>{
    fn = fn || <span class="hljs-string">'get'</span> ;
    <span class="hljs-keyword">var</span> ph_row = <span class="hljs-keyword">this</span>.index[row_num];
    <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">this</span>.columnSet.getColumn(col);
    <span class="hljs-keyword">return</span> c[fn](ph_row);
  };</pre></div></div>
            
        </li>
        
              <a name="DataFrame.prototype.set" />
        
        <li id="section-15">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><strong>set(row_num,col,v)</strong></p>
<p>set value in one cell of DataFrame</p>
<ul>
<li><code>row_num</code> - row number</li>
<li><code>col</code> - column index or column name</li>
<li><code>v</code> -  value to set</li>
</ul>

            </div>
            
                 <div class="content"><div class='highlight'><pre>  DataFrame.prototype.set = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">row_num, col, v</span>) </span>{
    <span class="hljs-keyword">var</span> ph_row = <span class="hljs-keyword">this</span>.index[row_num];
    <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">this</span>.columnSet.getColumn(col);
    c.set(ph_row,v);
  };</pre></div></div>
            
        </li>
        
              <a name="DataFrame.prototype.getRowCount" />
        
        <li id="section-16">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p><strong>getRowCount()</strong></p>
<p>get row count</p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>  DataFrame.prototype.getRowCount = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.index.length;
  };

  DataFrame.prototype.newRow = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">row_num</span>) </span>{
    <span class="hljs-comment">/*
    adds new row. Returns new row number.

    @param row_num integer
       row where to insert new row. if omitted new row is appended.
     */</span>
    row_num = row_num || <span class="hljs-keyword">this</span>.index.length;
    <span class="hljs-keyword">var</span> new_storage_row = <span class="hljs-keyword">this</span>.columnSet.getStorageSize();
    <span class="hljs-keyword">this</span>.columnSet.setStorageSize(new_storage_row+<span class="hljs-number">1</span>);
    <span class="hljs-keyword">this</span>.index.splice(row_num,<span class="hljs-number">0</span>,new_storage_row);
    <span class="hljs-keyword">return</span> row_num;
  };

  DataFrame.prototype.setRow = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">row_num,row_data</span>) </span>{
    <span class="hljs-comment">/*
    @param row_num
      row to set
    @param row_data array or object
      data to set in row
     */</span>
    <span class="hljs-keyword">var</span> ph_row = <span class="hljs-keyword">this</span>.index[row_num];
    <span class="hljs-keyword">if</span> (_.isPlainObject(row_data)) {
      <span class="hljs-keyword">var</span> keys = <span class="hljs-built_in">Object</span>.keys(row_data);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; keys.length; k++) {
        <span class="hljs-keyword">this</span>.columnSet.getColumn(keys[k]).set(ph_row, row_data[keys[k]]);
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isArray(row_data)) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> col_idx = <span class="hljs-number">0</span>; col_idx &lt; row_data.length; col_idx++) {
        <span class="hljs-keyword">this</span>.columnSet.getColumn(col_idx).set(ph_row, row_data[col_idx]);
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">throw</span> u$.error(<span class="hljs-string">"row should be object or array and not:"</span> + row_data);
    }
  };

  DataFrame.prototype.addRow = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">row_data,row_num</span>) </span>{
    <span class="hljs-comment">/*
     @param row_data array or object
       row data to add
     @param row_num integer @optional
       where to insert row, if omitted row is appended
     */</span>
    <span class="hljs-keyword">this</span>.setRow(<span class="hljs-keyword">this</span>.newRow(row_num),row_data);
  };</pre></div></div>
            
        </li>
        
              <a name="DataFrame.prototype.deleteRow" />
        
        <li id="section-17">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><strong>deleteRow(row_num)</strong></p>
<p>delete row by <code>row_num</code>.</p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>  DataFrame.prototype.deleteRow = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">row_num</span>) </span>{
    <span class="hljs-keyword">this</span>.index.splice(row_num, <span class="hljs-number">1</span>);
  };</pre></div></div>
            
        </li>
        
              <a name="DataFrame.prototype.getColumn" />
        
        <li id="section-18">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>getColumn(col)</p>
<p>get all data out column. returns array of values</p>
<ul>
<li><code>col</code> - column index or column name</li>
</ul>

            </div>
            
                 <div class="content"><div class='highlight'><pre>  DataFrame.prototype.getColumn = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">col</span>) </span>{
    <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">this</span>.columnSet.getColumn(col);
    <span class="hljs-keyword">if</span> (c) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.index.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">idx</span>) </span>{
        <span class="hljs-keyword">return</span> c.get(idx);
      });
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
  };

  DataFrame.prototype.getColumnIndex = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name_or_idx</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.columnSet.getColumn(name_or_idx).col_idx;
  };
  DataFrame.prototype.getColumnName = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name_or_idx</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.columnSet.getColumn(name_or_idx).name;
  };</pre></div></div>
            
        </li>
        
              <a name="DataFrame.prototype.apply" />
        
        <li id="section-19">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><strong> apply(logic) </strong></p>
<p>run <code>logic(df,row_num)</code> function on all rows of DataFrame</p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>  DataFrame.prototype.apply = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">logic</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> row_num = <span class="hljs-number">0</span>; row_num &lt; <span class="hljs-keyword">this</span>.index.length; row_num++) {
      logic.call(<span class="hljs-keyword">this</span>, row_num);
    }
  };</pre></div></div>
            
        </li>
        
              <a name="DataFrame.prototype.map" />
        
        <li id="section-20">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><strong> map(logic) </strong></p>
<p>run <code>logic(df,row_num)</code> function on all rows of DataFrame.
Collect results from each run into array. <code>undefined</code> results
will not be included in array.</p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>  DataFrame.prototype.map = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">logic</span>) </span>{
    <span class="hljs-keyword">var</span> collector = [], r;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> row_num = <span class="hljs-number">0</span>; row_num &lt; <span class="hljs-keyword">this</span>.index.length; row_num++) {
      r = logic.call(<span class="hljs-keyword">this</span>, row_num);
      <span class="hljs-keyword">if</span> (r !== <span class="hljs-literal">undefined</span>) {
        collector.push(r);
      }
    }
    <span class="hljs-keyword">return</span> collector;
  };</pre></div></div>
            
        </li>
        
              <a name="DataFrame.prototype.getConfig" />
        
        <li id="section-21">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><strong>getData()</strong></p>
<p>Get all data in structure:
returns {Object}</p>
<ul>
<li>config :<ul>
<li>columns - columns array<ul>
<li>name - column name</li>
<li>type - column type, if defined</li>
</ul>
</li>
</ul>
</li>
<li>rows - array of rows. each row array of values.</li>
</ul>

            </div>
            
                 <div class="content"><div class='highlight'><pre>
  DataFrame.prototype.getConfig=<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> config = { columns : []};
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> col = <span class="hljs-number">0</span>; col &lt; <span class="hljs-keyword">this</span>.columnSet.byIndex.length; col++) {
      <span class="hljs-keyword">var</span> column = <span class="hljs-keyword">this</span>.columnSet.byIndex[col];
      <span class="hljs-keyword">var</span> col_def = {name: column.name};
      <span class="hljs-keyword">if</span> (column.type) {
        col_def.type = column.type.name;
      }
      config.columns.push(col_def);
    }
    <span class="hljs-keyword">return</span> config;
  };

  DataFrame.prototype.getData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> r = { config: <span class="hljs-keyword">this</span>.getConfig(), rows: []};
    r.rows = <span class="hljs-keyword">this</span>.map( <span class="hljs-keyword">this</span>.getArrayRow ) ;
    <span class="hljs-keyword">return</span> r;
  };

  DataFrame.prototype.setColumnType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">col,new_type</span>) </span>{
    <span class="hljs-keyword">this</span>.columnSet.getColumn(col).setType(new_type);
  };

  DataFrame.SortCriteria = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">criteria</span>)</span>{
    <span class="hljs-keyword">this</span>.parts = [];
    <span class="hljs-keyword">for</span>( <span class="hljs-keyword">var</span> i  = <span class="hljs-number">0</span> ; i &lt;  criteria.length ; i++){
      <span class="hljs-keyword">var</span> p  = <span class="hljs-keyword">this</span>.parts[i] = {} ;
      <span class="hljs-keyword">var</span> c  = criteria[i];
      <span class="hljs-keyword">if</span>(_.isPlainObject(c)) {
        p.name = c.name;
        p.order = u$.sorting(c.order);
      }<span class="hljs-keyword">else</span>{
        p.name = c[<span class="hljs-number">0</span>];
        p.order = u$.sorting(c[<span class="hljs-number">1</span>]);
      }
      p.decorate_order_fn = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">asc_order_fn</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.order ? u$.orderInverse(asc_order_fn) : asc_order_fn ;
      }
    }
  };

  DataFrame.SortCriteria.prototype._phrow_order_fn = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">df,row_data</span>)</span>{
    <span class="hljs-keyword">var</span> orders = [] ;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create_ph_order</span>(<span class="hljs-params">column,order</span>)</span>{
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_get_data</span>(<span class="hljs-params">phrow</span>)</span>{
        <span class="hljs-keyword">if</span>(phrow===<span class="hljs-number">-1</span>){
          <span class="hljs-keyword">if</span>(_.isArray(row_data) ){
            <span class="hljs-keyword">return</span> row_data[column.col_idx];
          }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">return</span> row_data[column.name];
          }
        }<span class="hljs-keyword">else</span>{
          <span class="hljs-keyword">return</span> column.get(phrow);
        }
      }
      <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ph1,ph2</span>)</span>{
        <span class="hljs-keyword">var</span> v1 = _get_data(ph1);
        <span class="hljs-keyword">var</span> v2 = _get_data(ph2);
        <span class="hljs-keyword">try</span>{</pre></div></div>
            
        </li>
        
        <li id="section-22">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>console.log(column.name,ph1,ph2,v1,v2,o);</p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> order(v1, v2);
        }<span class="hljs-keyword">catch</span>(e){
          <span class="hljs-keyword">throw</span> u$.error({
            col: column.name,
            ph1:ph1,ph2:ph2,
            v1:v1,v2:v2
          },e);
        }
      }
    }
    <span class="hljs-keyword">for</span>( <span class="hljs-keyword">var</span> i  = <span class="hljs-number">0</span> ; i &lt;  <span class="hljs-keyword">this</span>.parts.length ; i++) {
      <span class="hljs-keyword">var</span> column = df.columnSet.getColumn(<span class="hljs-keyword">this</span>.parts[i].name);
      <span class="hljs-keyword">var</span> order = column.type ? column.type.compare : u$.orderNullsFirst(u$.generic_order) ;
      <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.parts[i].order ) order = u$.orderInverse(order);
      orders.push(create_ph_order(column,  order ));
    }
    <span class="hljs-keyword">return</span> u$.orderChain(orders);
  };

  DataFrame.prototype.sort=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">criteria</span>)</span>{
    <span class="hljs-keyword">this</span>.index.sort(criteria._phrow_order_fn(<span class="hljs-keyword">this</span>));
  };

  DataFrame.prototype.find=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">criteria,row_data</span>)</span>{
    <span class="hljs-keyword">return</span> u$.binarySearch(<span class="hljs-number">-1</span>, <span class="hljs-keyword">this</span>.index, criteria._phrow_order_fn(<span class="hljs-keyword">this</span>,row_data));
  };

  <span class="hljs-comment">/*
   find
   method assumne that dataframe is sorted by column `col`
   @param col
   col_name or col_idx
   @param value
   to search for in column
   @returns number
   positive number indicates were matcheing record was found or negative  number
   */</span></pre></div></div>
            
        </li>
        
              <a name="DataFrame.prototype.getObjects" />
        
        <li id="section-23">

            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><strong>getObjects()</strong></p>
<p>returns all rows in  array , each row is object
with column names pointing to values</p>

            </div>
            
                 <div class="content"><div class='highlight'><pre>
  DataFrame.prototype.getObjects = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.map( <span class="hljs-keyword">this</span>.getObjectRow );
  };

  u$.addTypes({
    dataframe: {
      is: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">o</span>)</span>{
        <span class="hljs-keyword">return</span> (o &amp;&amp;  o.type === <span class="hljs-string">'DataFrame'</span>)
            || o <span class="hljs-keyword">instanceof</span> DataFrame ;
      },
      missing: _.isNull,
      from_string: DataFrame.parse_json,
      to_json: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) </span>{
        <span class="hljs-keyword">return</span> _.isNull(v) ? <span class="hljs-literal">null</span> : v.to_json();
      },
      order: u$.no_order
    }
  });

  <span class="hljs-keyword">var</span> FILE_INFO_COLUMNS = [ <span class="hljs-string">'content_type'</span>, <span class="hljs-string">'filesize'</span>, <span class="hljs-string">'mtime'</span> ];


  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">emptyFragmentsStore</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DataFrame([], {
      columns: [
        {name: <span class="hljs-string">'content_type'</span>, type: <span class="hljs-string">'string'</span>},
        {name: <span class="hljs-string">'filesize'</span>, type: <span class="hljs-string">'number'</span>},
        {name: <span class="hljs-string">'mtime'</span>, type: <span class="hljs-string">'timestamp'</span>},
        {name: <span class="hljs-string">'start_position'</span>, type: <span class="hljs-string">'number'</span>},
        {name: <span class="hljs-string">'end_position'</span>, type: <span class="hljs-string">'number'</span>},
        {name: <span class="hljs-string">'num_of_records'</span>, type: <span class="hljs-string">'number'</span>},
        {name: <span class="hljs-string">'direction'</span>, type: <span class="hljs-string">'string'</span>},
        {name: <span class="hljs-string">'fragment'</span>, type: <span class="hljs-string">'dataframe'</span>},
      ]
    });
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">directional_storage</span> (<span class="hljs-params">direction</span>)</span>{
    <span class="hljs-keyword">return</span> {
      df: emptyFragmentsStore() ,
      add: direction == <span class="hljs-string">'F'</span> ?
          <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">meta</span>)</span>{
            <span class="hljs-keyword">var</span> rowCount = <span class="hljs-keyword">this</span>.df.getRowCount();
            <span class="hljs-keyword">var</span> append =
                ( rowCount == <span class="hljs-number">0</span> &amp;&amp; meta.start_position === <span class="hljs-number">0</span> ) ||
                ( rowCount &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">this</span>.df.get(rowCount<span class="hljs-number">-1</span>,<span class="hljs-string">'end_position'</span>) === meta.start_position) ;
            <span class="hljs-keyword">if</span>( append ){
              <span class="hljs-keyword">this</span>.df.addRow(meta);
            }
            <span class="hljs-keyword">return</span> append;
          }:
          <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">meta</span>)</span>{
            <span class="hljs-keyword">var</span> rowCount = <span class="hljs-keyword">this</span>.df.getRowCount();
            <span class="hljs-keyword">var</span> prepend =
                ( rowCount == <span class="hljs-number">0</span> &amp;&amp; meta.end_position === meta.filesize ) ||
                ( rowCount &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">this</span>.df.get(<span class="hljs-number">0</span>,<span class="hljs-string">'start_position'</span>) === meta.end_position) ;
            <span class="hljs-keyword">if</span>( prepend ){
              <span class="hljs-keyword">this</span>.df.addRow(meta,<span class="hljs-number">0</span>);
            }
            <span class="hljs-keyword">return</span> prepend;
          }
     };
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newFragmentStorage</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> {
      F: directional_storage(<span class="hljs-string">'F'</span>),
      B: directional_storage(<span class="hljs-string">'B'</span>)
    };
  }

  DataFrame.MultiPart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fragment_factory,  config </span>)</span>{
    <span class="hljs-comment">/*
    @param parser {}
      @param header function(buffer,offset) returns newoffset
      @param line function(buffer,offset) return newoffset
    @param fragment_factory function(direction, offset)
    @param columns [] or undefined
     provided if first fragment does not contain header.
     */</span>
    <span class="hljs-keyword">this</span>.file_type = file_type ;
    <span class="hljs-keyword">this</span>.fragment_factory = fragment_factory;
    <span class="hljs-keyword">this</span>.config = config ;
    <span class="hljs-keyword">this</span>.hasHeader = ! u$.isNullish(config);
    <span class="hljs-keyword">this</span>.fileInfo = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.fragments = newFragmentStorage();
    <span class="hljs-keyword">this</span>.fragment_factory(<span class="hljs-string">'F'</span>,<span class="hljs-number">0</span>).then( <span class="hljs-keyword">this</span>.parse_fragment.bind(<span class="hljs-keyword">this</span>) ) ;
  };

  <span class="hljs-keyword">var</span> mime2parser = {
    <span class="hljs-string">'text/plain'</span> : {
      parse: parse_lf_separated,
      static_header: { columns: [ <span class="hljs-string">'line'</span> ] } },
    <span class="hljs-string">'text/wdf'</span> : {
      parse: parse_lf_separated_json,
      adjust_header: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">header</span>)</span>{<span class="hljs-keyword">return</span> header;} },
    <span class="hljs-string">'text/csv'</span> : {
      parse: parse_csv_to_array_of_rows,
      adjust_header: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">header</span>)</span>{<span class="hljs-keyword">return</span> {columns: header};} },
  };

  DataFrame.MultiPart.prototype.difer=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fragment,fragment_data</span>)</span>{
    <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.fileInfo &amp;&amp; !_.isEqual(<span class="hljs-keyword">this</span>.fileInfo, fragment_data.file_info) ){
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">if</span>( !<span class="hljs-keyword">this</span>.deferred_fragments ){
      <span class="hljs-keyword">this</span>.deferred_fragments = [];
    }
    <span class="hljs-keyword">var</span> pos = fragment_data.direction == <span class="hljs-string">'F'</span> ?
          fragment_data.start_position :
          fragment_data.filesize - fragment_data.end_position ;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span> ; i &lt; <span class="hljs-keyword">this</span>.deferred_fragments.length ; i++){
      <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.deferred_fragments[i].pos &gt; pos ) <span class="hljs-keyword">break</span> ;
    }
    <span class="hljs-keyword">this</span>.deferred_fragments.splice(i, <span class="hljs-number">0</span>, {pos: pos, fragment: fragment} );
  };

  DataFrame.MultiPart.prototype.parse_fragment=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fragment</span>)</span>{
    <span class="hljs-keyword">var</span> meta_data_idx = fragment.indexOf(<span class="hljs-string">'\n'</span>);
    <span class="hljs-keyword">var</span> fragment_data = <span class="hljs-built_in">JSON</span>.parse(fragment.substr(<span class="hljs-number">0</span>,meta_data_idx));
    <span class="hljs-comment">/*
     @param filesize
        size of file
     @param mtime
        modification time of file
     @param start_position @param end_position
        fragment boundaries in file. `end_positon` can be smaller
        then `start position` if direction is backward `'B'`
     @param num_of_records
     @param content_type
        mime type of original file
     @param direction 'F' or 'B'
     */</span>
    <span class="hljs-keyword">var</span> parser = mime2parser[fragment_data.content_type];

    <span class="hljs-keyword">if</span>( !<span class="hljs-keyword">this</span>.hasHeader &amp;&amp; parser.static_header ){
      <span class="hljs-keyword">this</span>.config = parser.static_header;
    }

    fragment_data.file_info = u$.assignByKeys({}, fragment_data, FILE_INFO_COLUMNS);
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.fileInfo === <span class="hljs-literal">null</span>){
      <span class="hljs-keyword">this</span>.fileInfo = fragment_data.file_info;
    }<span class="hljs-keyword">else</span>{
      <span class="hljs-keyword">if</span>( !_.isEqual(<span class="hljs-keyword">this</span>.fileInfo, fragment_data.file_info) ){
        <span class="hljs-keyword">this</span>.fileInfo = fragment_data.file_info;
        <span class="hljs-keyword">this</span>.fragments = newFragmentStorage() ;
      }
    }
    <span class="hljs-keyword">if</span>( fragment_data.start_position !== <span class="hljs-number">0</span> &amp;&amp; ! <span class="hljs-keyword">this</span>.hasHeader &amp;&amp; ! <span class="hljs-keyword">this</span>.config ) {
      <span class="hljs-keyword">this</span>.difer(fragment, fragment_data )
    }<span class="hljs-keyword">else</span>{
      <span class="hljs-keyword">var</span> rows = parser.parse(fragment,meta_data_idx+<span class="hljs-number">1</span>);
      <span class="hljs-keyword">if</span>( fragment_data.start_position === <span class="hljs-number">0</span> &amp;&amp; fragment_data.end_position &gt; <span class="hljs-number">0</span> ){
        <span class="hljs-keyword">if</span>( ! <span class="hljs-keyword">this</span>.hasHeader ){
          <span class="hljs-keyword">this</span>.config = parser.adjust_header(rows.shift());
        }
      }
      fragment_data.fragment = <span class="hljs-keyword">new</span> DataFrame(rows,<span class="hljs-keyword">this</span>.config);
      <span class="hljs-keyword">var</span> processed = <span class="hljs-keyword">this</span>.fragments[fragment_data.direction].add(fragment_data);
      <span class="hljs-keyword">if</span>(!processed){
        <span class="hljs-keyword">this</span>.difer(fragment,fragment_data);
      }
      <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.deferred_fragments ){
        <span class="hljs-keyword">var</span> deferred = <span class="hljs-keyword">this</span>.deferred_fragments;
        <span class="hljs-keyword">this</span>.deferred_fragments = <span class="hljs-literal">undefined</span>;
        <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span> ;
        deferred.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f</span>)</span>{
          self.parse_fragment(f.fragment);
        });
      }
    }

  };
  <span class="hljs-built_in">module</span>.exports = DataFrame;


})();</pre></div></div>
            
        </li>
        
    </ul>
    <p>
  

  </div>
</body>
</html>
